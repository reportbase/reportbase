<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hello Bulma!</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  </head>
  <body>
<script src="https://accounts.google.com/gsi/client" async defer></script>

<section class="hero is-info">
  <div class="hero-body">
    <p class="title">
      Image Galleries
    </p>
    <p class="subtitle">
      Uploads/Downloads
    </p>
  </div>
</section>
	  
  <section class="section">
    <div class="container">

<form id=uploadformdata>  
<input type="file" id="file" multiple="multiple">
<button type="submit">Upload</button>
</form>
	
<form id=galleryform> 	
<label for="email">Email:</label><br>
<input type="text" id="name" name="name">
<button type="submit">Show</button>
</form>
    </div>
  </section>
	  
  <section class="section">
    <div class="container">
	    
<div id="wrapper"></div>
<script>
function gridshow(results)
{
    	var email = document.getElementById("name").value;
	if (!email)
		return;
	
	fetch(`https://bucket.reportbase5836.workers.dev/zips/${email}`)
	.then(function(response) 
	      {
		      if (response.ok)
			return response.json()
			throw Error(response.statusText);
	      })
	.then(function(results)
	      {      
		var str = `<article class="media">`;     
		for (var n = 0; n < results.length; ++n)
		{
			var result = results[n];
			str += `<div class="card">
			  <div class="card-image">
			    <figure class="image is-4by3">
			      <a href='https://zip-view.pages.dev/?r2=${result.id}'>${result.title}'>
			      	<img width=640 height=640 src="https://bulma.io/images/placeholders/1280x960.png" alt="Placeholder image">
	  		      </a>
			    </figure>
			  </div>
			  <div class="card-content">
			    <div class="media">
			      <div class="media-left">
			        <figure class="image is-48x48">
			          <img src="https://bulma.io/images/placeholders/96x96.png" alt="Placeholder image">
			        </figure>
			      </div>
			      <div class="media-content">
			        <p class="title is-4">John Smith</p>
			        <p class="subtitle is-6">@johnsmith</p>
			      </div>
			    </div>
			
			    <div class="content">
			      Lorem ipsum dolor sit amet, consectetur adipiscing elit.
			      Phasellus nec iaculis mauris. <a>@bulmaio</a>.
			      <a href="#">#css</a> <a href="#">#responsive</a>
			      <br>
			      <time datetime="2016-1-1">11:09 PM - 1 Jan 2016</time>
			    </div>
			  </div>
			</div>`
		}
		      
		str += "</article>"
		document.getElementById("wrapper").innerHTML = str;      
	})
	.catch(error => console.log(error));
}
gridshow();
</script>
	
<script>

    const galleryform = document.getElementById('galleryform');
    galleryform.addEventListener('submit', async event => 
    {
	    event.preventDefault();
	    gridshow(); 
    })

    const uploadformdata = document.getElementById('uploadformdata');
    uploadformdata.addEventListener('submit', async event => 
    {
      event.preventDefault();
	var email = document.getElementById("name").value;
    if (!email)
	    return;
	    
	var files = document.getElementById('file').files;
	    for (var n = 0; n < files.length; ++n)
	    {
	      const file = files[n];
	      const form = new FormData();
	      form.append('file', file);
	      form.append('title', file.name.split('.')[0]);
	      form.append('email', email);

	      fetch(`https://bucket.reportbase5836.workers.dev/bucket1`,
	      {
		'method': 'POST',
		'body': form
	      })
 		.then(function(response) 
                      {
                              if (response.ok)
                                return response.text()
                                throw Error(response.statusText);
                      })
		.then(function(results)
		      {
			      gridshow();
		      })
                .catch(error => console.log(error)); 
	    }
    });
</script>    
	
    </div>
  </section>
  </body>
</html>

