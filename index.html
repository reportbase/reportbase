<html>
<head>
<link href="https://cdn.jsdelivr.net/npm/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
</head>
	
<body>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://cdn.jsdelivr.net/npm/gridjs/dist/gridjs.umd.js"></script>
	
<form id=uploadformdata>  
<input type="file" id="file" multiple="multiple">
<button type="submit">Upload</button>
</form>
<br>
	
<form id=galleryform> 	
<label for="email">Email:</label><br>
<input type="text" id="name" name="name">
<button type="submit">Show</button>
</form>
<p>

	
<div id="wrapper"></div>
<script>
function gridshow(results)
{
    	var email = document.getElementById("name").value;
	if (!email)
		return;
	
	fetch(`https://bucket.reportbase5836.workers.dev/zips/${email}`)
	.then(function(response) 
	      {
		      if (response.ok)
			return response.json()
			throw Error(response.statusText);
	      })
	.then(function(results)
	      {
		var data = []
		for (var n = 0; n < results.length; ++n)
		{
			var k = [];
			var result = results[n];
			k.push({"id:": res.id, "title": res.title});
			data.push(k);
		}
		new gridjs.Grid(
		{
		  columns: 
		[
		      { 
			name: 'Title',
			formatter: (cell) => html(
				`<a href=https://zip-view.pages.dev/?r2=${cell.id}>${cell.title}</a>`)
		      }
		],
			pagination: true,
			search: true,
			sort: true,
			resizable: true,	
		  	data: data
		}).render(document.getElementById("wrapper"));
	      })
	.catch(error => console.log(error));
}
gridshow();
</script>
	
<script>

    const galleryform = document.getElementById('galleryform');
    galleryform.addEventListener('submit', async event => 
    {
	    event.preventDefault();
	    gridshow(); 
    })

    const uploadformdata = document.getElementById('uploadformdata');
    uploadformdata.addEventListener('submit', async event => 
    {
      event.preventDefault();
	var email = document.getElementById("name").value;
    if (!email)
	    return;
	    
	var files = document.getElementById('file').files;
	    for (var n = 0; n < files.length; ++n)
	    {
	      const file = files[n];
	      const form = new FormData();
	      form.append('file', file);
	      form.append('title', file.name.split('.')[0]);
	      form.append('email', email);

	      fetch(`https://bucket.reportbase5836.workers.dev/bucket1`,
	      {
		'method': 'POST',
		'body': form
	      })
 		.then(function(response) 
                      {
                              if (response.ok)
                                return response.text()
                                throw Error(response.statusText);
                      })
		.then(function(results)
		      {
			      console.log(results);
		      })
                .catch(error => console.log(error)); 
	    }
    });
</script>    

</body>
</html>
