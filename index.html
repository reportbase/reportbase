<html>
<body>
<script src="https://accounts.google.com/gsi/client" async defer></script>

<form id="uploadformdata">  
<input type="file" id="file" multiple="multiple"> 
<button type="submit">Upload FormData</button><br>
<label for="email">Email:</label><br>
<input type="text" id="name" name="name"><br>
</form>

<script>
        async function handleCredentialResponse(response) 
        {
                console.log("Encoded JWT ID token: " + response.credential);
                fetch(`https://reportbase.me/login`, 
                {
		        method: 'post',
			body: JSON.stringify(response)
                })
                .then(function(response) 
                      {
                              if (response.ok)
                                return response.json()
                                throw Error(response.statusText);
                      })
                .then(function(json)
                      {
                              console.log(json)
                      })
                .catch(error => console.log(error));           
         }
        
        window.onload = function () 
        {
          google.accounts.id.initialize(
          {
            client_id: "676848032016-7rdfc1a1gse8olfh399kfqtahqvu5ci5.apps.googleusercontent.com",
            callback: handleCredentialResponse
          });
                
          google.accounts.id.renderButton(
            document.getElementById("buttonDiv"),
            { theme: "outline", size: "large" }
          );
          google.accounts.id.prompt(); 
        }
    
    const uploadformdata = document.getElementById('uploadformdata');
    uploadformdata.addEventListener('submit', async event => 
    {
      event.preventDefault();

	var files = document.getElementById('file').files;
	    for (var n = 0; n < files.length; ++n)
	    {
	      const file = files[n];
	      const form = new FormData();
	      form.append('file', file);

	      fetch(`https://bucket.reportbase5836.workers.dev/bucket1`, 
	      {
		method: 'POST',
		body: form
	      })
 		.then(function(response) 
                      {
                              if (response.ok)
                                return response.text()
                                throw Error(response.statusText);
                      })
		.then(function(key)
		      {
			      //fetch(`https://database.reportbase5836.workers.dev/userzip`, 
				fetch(`https://sidney.reportbase5836.workers.dev`,
				{
					method: 'PUT',
					body: 
				      JSON.stringify({
					user: "9abec42c-acf2-422b-b2a1-00623fcd3765",
					zip: key
				      })
				    })				      
			     .then(function(response) 
			      {
				      if (response.ok)
					return response.json()
					throw Error(response.statusText);
			      })
			      .then(function(json)
			      {
				      console.log(json)
			      })
			      .catch(error => console.log(error));	
		      })
                .catch(error => console.log(error)); 
	    }
    });
</script>    

      <script src="https://accounts.google.com/gsi/client" async defer></script>
      <div id="g_id_onload"
         data-client_id="676848032016-7rdfc1a1gse8olfh399kfqtahqvu5ci5.apps.googleusercontent.com"
         data-ux_mode="redirect"
         data-login_uri="https://reportbase.me/login"
      </div>
      <div class="g_id_signin"
         data-type="standard"
         data-size="large"
         data-theme="outline"
         data-text="sign_in_with"
         data-shape="rectangular"
         data-logo_alignment="left">
      </div>
</body>
</html>
